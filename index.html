<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cockpit Projets 2026 - DSIM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        manche: {
                            blue: '#1a4480',
                            gold: '#e8a825',
                            light: '#f0f4f8',
                            dark: '#0d2240',
                        }
                    },
                    fontFamily: {
                        sans: ['Source Sans Pro', 'sans-serif'],
                        display: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Source Sans Pro', sans-serif; }
        .gradient-header {
            background: linear-gradient(135deg, #1a4480 0%, #0d2240 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        .nav-item.active {
            background: rgba(255,255,255,0.15);
            border-left: 3px solid #e8a825;
        }
        .timeline-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
        }
        .checkbox-custom:checked {
            background-color: #1a4480;
            border-color: #1a4480;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .priority-p0 { border-left: 4px solid #dc2626; }
        .priority-p1 { border-left: 4px solid #f59e0b; }
        .priority-p2 { border-left: 4px solid #3b82f6; }
        .priority-p3 { border-left: 4px solid #6b7280; }

        /* Notifications */
        .notification-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            transition: right 0.3s ease;
            z-index: 100;
            overflow-y: auto;
        }
        .notification-panel.open {
            right: 0;
        }
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #dc2626;
            color: white;
            font-size: 11px;
            font-weight: bold;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Recherche globale */
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 100px;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
        }
        .search-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .search-container {
            background: white;
            border-radius: 12px;
            width: 600px;
            max-height: 70vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            transform: translateY(-20px);
            transition: transform 0.2s;
        }
        .search-overlay.open .search-container {
            transform: translateY(0);
        }
        .search-result:hover {
            background: #f0f4f8;
        }

        /* Pulse animation pour les alertes */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ========================================
        // DATA - √âtat initial des projets
        // ========================================
        const initialProjects = [
            {
                id: 1,
                name: "Sensibilisation √©lus IA",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "Initialisation",
                status: "En cours",
                progress: 15,
                alert: "red",
                priority: "P0",
                nextAction: "Caler date avec Cabinet + confirmer prestataire",
                deadline: "2026-01-15",
                responsible: "",
                notes: "Journ√©e en 2 temps : matin prestataire, apr√®s-midi atelier DSIM"
            },
            {
                id: 2,
                name: "Vote strat√©gie IA/Data",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "En cours",
                status: "En cours",
                progress: 40,
                alert: "red",
                priority: "P0",
                nextAction: "Finaliser document strat√©gie (apr√®s sensibilisation)",
                deadline: "2026-02-26",
                responsible: "",
                notes: "Session pl√©ni√®re du 03/04/2026"
            },
            {
                id: 3,
                name: "Plan sensibilisation agents",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "Initialisation",
                status: "√Ä planifier",
                progress: 5,
                alert: "green",
                priority: "P2",
                nextAction: "Cadrage apr√®s vote strat√©gie",
                deadline: "2026-04-30",
                responsible: "",
                notes: ""
            },
            {
                id: 4,
                name: "Plan communication IA",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "Initialisation",
                status: "√Ä planifier",
                progress: 5,
                alert: "green",
                priority: "P2",
                nextAction: "Cadrage apr√®s vote strat√©gie",
                deadline: "2026-04-30",
                responsible: "",
                notes: ""
            },
            {
                id: 5,
                name: "Tests outils IA r√©unions",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "En cours",
                status: "En cours",
                progress: 10,
                alert: "yellow",
                priority: "P1",
                nextAction: "Lancer benchmark outils (transcription, r√©sum√©)",
                deadline: "2026-01-31",
                responsible: "",
                notes: ""
            },
            {
                id: 6,
                name: "Programme Copilot+ Microsoft",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "Initialisation",
                status: "√Ä planifier",
                progress: 5,
                alert: "yellow",
                priority: "P1",
                nextAction: "Se renseigner sur conditions programme Microsoft",
                deadline: "2026-01-31",
                responsible: "",
                notes: ""
            },
            {
                id: 7,
                name: "Feuille de route IA/Data",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "√Ä lancer",
                status: "√Ä planifier",
                progress: 0,
                alert: "green",
                priority: "P1",
                nextAction: "D√©marrage apr√®s vote strat√©gie",
                deadline: "2026-06-30",
                responsible: "",
                notes: ""
            },
            {
                id: 8,
                name: "Consultation AMO IA/Data",
                program: "Strat√©gie IA/Data",
                process: "Conception",
                phase: "√Ä lancer",
                status: "√Ä planifier",
                progress: 5,
                alert: "green",
                priority: "P2",
                nextAction: "Commencer trame CCTP AMO",
                deadline: "2026-02-28",
                responsible: "",
                notes: ""
            },
            {
                id: 9,
                name: "Solution march√©s publics",
                program: "Modernisation",
                process: "Conception",
                phase: "Initialisation",
                status: "En cours",
                progress: 5,
                alert: "yellow",
                priority: "P1",
                nextAction: "Organiser 1er COPIL de lancement",
                deadline: "2026-01-31",
                responsible: "",
                notes: "Nouveau projet 2026"
            },
            {
                id: 10,
                name: "Cartographie SI Dir. Routes",
                program: "Modernisation",
                process: "Conception",
                phase: "√Ä lancer",
                status: "√Ä planifier",
                progress: 0,
                alert: "green",
                priority: "P3",
                nextAction: "Attente lancement",
                deadline: "2026-06-30",
                responsible: "",
                notes: "Arriv√©e en cours d'ann√©e"
            }
        ];

        const initialCalendar = [
            { date: "2026-01-15", type: "cible", label: "Sensibilisation √©lus IA", project: "Strat√©gie IA/Data", status: "√Ä confirmer", critical: false },
            { date: "2026-01-23", type: "CP", label: "Commission permanente", project: "", status: "", critical: false },
            { date: "2026-02-13", type: "CP", label: "Commission permanente", project: "", status: "", critical: false },
            { date: "2026-02-26", type: "DLVD", label: "Validation Directeurs (DLVD CD04)", project: "Strat√©gie IA/Data", status: "Critique", critical: true },
            { date: "2026-03-03", type: "DLVR", label: "Validation DGA (DLVR CD04)", project: "Strat√©gie IA/Data", status: "Important", critical: false },
            { date: "2026-03-10", type: "CLecture", label: "Comit√© de lecture CD04", project: "Strat√©gie IA/Data", status: "", critical: false },
            { date: "2026-03-13", type: "CP", label: "Commission permanente", project: "", status: "", critical: false },
            { date: "2026-04-03", type: "SP", label: "SESSION PL√âNI√àRE", project: "Strat√©gie IA/Data", status: "Objectif", critical: true },
            { date: "2026-04-24", type: "CP", label: "Commission permanente", project: "", status: "", critical: false },
            { date: "2026-06-19", type: "CP", label: "Commission permanente", project: "", status: "", critical: false },
            { date: "2026-07-03", type: "SP", label: "SESSION PL√âNI√àRE", project: "", status: "", critical: false },
        ];

        const initialWeeklyReviews = [];

        // ========================================
        // COMPOSANTS
        // ========================================

        // Navigation lat√©rale
        const Sidebar = ({ activeTab, setActiveTab, onExport, onImport }) => {
            const navItems = [
                { id: 'dashboard', label: 'Tableau de bord', icon: 'üìä' },
                { id: 'projects', label: 'Projets', icon: 'üìÅ' },
                { id: 'retroplanning', label: 'R√©tro-planning IA', icon: 'üéØ' },
                { id: 'calendar', label: 'Calendrier', icon: 'üìÖ' },
                { id: 'checklist', label: 'Check-lists', icon: '‚úÖ' },
                { id: 'weekly', label: 'Revue hebdo', icon: 'üîÑ' },
                { id: 'objectives', label: 'Objectifs 2026', icon: 'üèÜ' },
            ];

            const fileInputRef = React.useRef(null);

            const handleImportClick = () => {
                fileInputRef.current?.click();
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            onImport(data);
                        } catch (error) {
                            alert('Erreur: Le fichier JSON est invalide.');
                        }
                    };
                    reader.readAsText(file);
                    e.target.value = '';
                }
            };

            return (
                <aside className="w-64 gradient-header min-h-screen fixed left-0 top-0 text-white">
                    <div className="p-6 border-b border-white/10">
                        <h1 className="font-display text-xl font-bold text-manche-gold">Cockpit Projets</h1>
                        <p className="text-sm text-white/70 mt-1">DSIM - 2026</p>
                    </div>
                    <nav className="mt-4">
                        {navItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`nav-item w-full text-left px-6 py-3 flex items-center gap-3 transition-all ${activeTab === item.id ? 'active' : ''}`}
                            >
                                <span className="text-lg">{item.icon}</span>
                                <span className="font-medium">{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    {/* Boutons Export/Import */}
                    <div className="absolute bottom-20 left-0 right-0 px-4">
                        <div className="border-t border-white/10 pt-4 space-y-2">
                            <button
                                onClick={onExport}
                                className="w-full px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors"
                            >
                                <span>üíæ</span> Exporter (JSON)
                            </button>
                            <button
                                onClick={handleImportClick}
                                className="w-full px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors"
                            >
                                <span>üìÇ</span> Importer (JSON)
                            </button>
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".json"
                                onChange={handleFileChange}
                                className="hidden"
                            />
                        </div>
                    </div>

                    <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-white/10">
                        <p className="text-xs text-white/50 text-center">
                            Chef de projet<br/>Transformation Num√©rique
                        </p>
                    </div>
                </aside>
            );
        };

        // Carte statistique
        const StatCard = ({ label, value, icon, color, subtext }) => (
            <div className={`stat-card bg-white rounded-xl p-5 card-shadow transition-all duration-200 border-l-4 ${color}`}>
                <div className="flex justify-between items-start">
                    <div>
                        <p className="text-gray-500 text-sm font-medium">{label}</p>
                        <p className="text-3xl font-bold text-gray-800 mt-1">{value}</p>
                        {subtext && <p className="text-xs text-gray-400 mt-1">{subtext}</p>}
                    </div>
                    <span className="text-2xl">{icon}</span>
                </div>
            </div>
        );

        // Badge d'alerte
        const AlertBadge = ({ level }) => {
            const colors = {
                red: 'bg-red-100 text-red-700',
                yellow: 'bg-yellow-100 text-yellow-700',
                green: 'bg-green-100 text-green-700'
            };
            const labels = { red: 'üî¥', yellow: 'üü°', green: 'üü¢' };
            return (
                <span className={`px-2 py-1 rounded-full text-sm ${colors[level]}`}>
                    {labels[level]}
                </span>
            );
        };

        // Badge de priorit√©
        const PriorityBadge = ({ priority }) => {
            const colors = {
                P0: 'bg-red-600 text-white',
                P1: 'bg-orange-500 text-white',
                P2: 'bg-blue-500 text-white',
                P3: 'bg-gray-400 text-white'
            };
            return (
                <span className={`px-2 py-0.5 rounded text-xs font-bold ${colors[priority]}`}>
                    {priority}
                </span>
            );
        };

        // Barre de progression
        const ProgressBar = ({ value }) => (
            <div className="w-full bg-gray-200 rounded-full h-2">
                <div
                    className="bg-manche-blue h-2 rounded-full transition-all duration-300"
                    style={{ width: `${value}%` }}
                />
            </div>
        );

        // Composant de recherche globale
        const GlobalSearch = ({ isOpen, onClose, projects, calendar, onNavigate }) => {
            const [query, setQuery] = useState('');
            const inputRef = React.useRef(null);

            useEffect(() => {
                if (isOpen && inputRef.current) {
                    inputRef.current.focus();
                }
            }, [isOpen]);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        if (isOpen) {
                            onClose();
                        } else {
                            onClose(); // Cela d√©clenchera l'ouverture via le parent
                        }
                    }
                    if (e.key === 'Escape' && isOpen) {
                        onClose();
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isOpen, onClose]);

            const searchResults = useMemo(() => {
                if (!query.trim()) return { projects: [], calendar: [] };

                const q = query.toLowerCase();

                const matchedProjects = projects.filter(p =>
                    p.name.toLowerCase().includes(q) ||
                    p.program.toLowerCase().includes(q) ||
                    p.nextAction.toLowerCase().includes(q) ||
                    p.notes.toLowerCase().includes(q) ||
                    p.responsible.toLowerCase().includes(q)
                );

                const matchedCalendar = calendar.filter(c =>
                    c.label.toLowerCase().includes(q) ||
                    c.project.toLowerCase().includes(q)
                );

                return { projects: matchedProjects, calendar: matchedCalendar };
            }, [query, projects, calendar]);

            const handleResultClick = (type, item) => {
                if (type === 'project') {
                    onNavigate('projects');
                } else {
                    onNavigate('calendar');
                }
                onClose();
                setQuery('');
            };

            return (
                <div
                    className={`search-overlay ${isOpen ? 'open' : ''}`}
                    onClick={onClose}
                >
                    <div
                        className="search-container"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {/* Barre de recherche */}
                        <div className="p-4 border-b flex items-center gap-3">
                            <span className="text-gray-400 text-xl">üîç</span>
                            <input
                                ref={inputRef}
                                type="text"
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                                placeholder="Rechercher projets, √©v√©nements, actions..."
                                className="flex-1 text-lg outline-none"
                            />
                            <kbd className="px-2 py-1 bg-gray-100 rounded text-xs text-gray-500">ESC</kbd>
                        </div>

                        {/* R√©sultats */}
                        <div className="max-h-96 overflow-y-auto">
                            {!query.trim() ? (
                                <div className="p-8 text-center text-gray-400">
                                    <p className="text-lg mb-2">Tapez pour rechercher</p>
                                    <p className="text-sm">Raccourci: <kbd className="px-2 py-1 bg-gray-100 rounded">Ctrl+K</kbd></p>
                                </div>
                            ) : (
                                <>
                                    {/* Projets trouv√©s */}
                                    {searchResults.projects.length > 0 && (
                                        <div className="p-2">
                                            <p className="px-3 py-2 text-xs font-semibold text-gray-500 uppercase">
                                                Projets ({searchResults.projects.length})
                                            </p>
                                            {searchResults.projects.map(project => (
                                                <div
                                                    key={project.id}
                                                    onClick={() => handleResultClick('project', project)}
                                                    className="search-result p-3 rounded-lg cursor-pointer flex items-center gap-3"
                                                >
                                                    <span className="text-xl">üìÅ</span>
                                                    <div className="flex-1">
                                                        <p className="font-medium text-gray-800">{project.name}</p>
                                                        <p className="text-sm text-gray-500">{project.program} ‚Ä¢ {project.nextAction}</p>
                                                    </div>
                                                    <AlertBadge level={project.alert} />
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* √âv√©nements trouv√©s */}
                                    {searchResults.calendar.length > 0 && (
                                        <div className="p-2 border-t">
                                            <p className="px-3 py-2 text-xs font-semibold text-gray-500 uppercase">
                                                √âv√©nements ({searchResults.calendar.length})
                                            </p>
                                            {searchResults.calendar.map((event, idx) => (
                                                <div
                                                    key={idx}
                                                    onClick={() => handleResultClick('calendar', event)}
                                                    className="search-result p-3 rounded-lg cursor-pointer flex items-center gap-3"
                                                >
                                                    <span className="text-xl">üìÖ</span>
                                                    <div className="flex-1">
                                                        <p className="font-medium text-gray-800">{event.label}</p>
                                                        <p className="text-sm text-gray-500">
                                                            {new Date(event.date).toLocaleDateString('fr-FR')}
                                                            {event.project && ` ‚Ä¢ ${event.project}`}
                                                        </p>
                                                    </div>
                                                    {event.critical && <span className="text-red-500">‚ö†Ô∏è</span>}
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* Aucun r√©sultat */}
                                    {searchResults.projects.length === 0 && searchResults.calendar.length === 0 && (
                                        <div className="p-8 text-center text-gray-400">
                                            <p className="text-lg">Aucun r√©sultat pour "{query}"</p>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Panneau de notifications d'√©ch√©ances
        const NotificationPanel = ({ isOpen, onClose, projects, calendar }) => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const notifications = useMemo(() => {
                const notifs = [];

                // Projets en retard
                projects.forEach(p => {
                    if (p.status === 'Termin√©') return;
                    const deadline = new Date(p.deadline);
                    deadline.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));

                    if (diffDays < 0) {
                        notifs.push({
                            type: 'overdue',
                            title: p.name,
                            message: `En retard de ${Math.abs(diffDays)} jour(s)`,
                            priority: 'critical',
                            icon: 'üö®',
                            date: p.deadline
                        });
                    } else if (diffDays === 0) {
                        notifs.push({
                            type: 'today',
                            title: p.name,
                            message: "√âch√©ance aujourd'hui !",
                            priority: 'high',
                            icon: '‚ö†Ô∏è',
                            date: p.deadline
                        });
                    } else if (diffDays <= 3) {
                        notifs.push({
                            type: 'soon',
                            title: p.name,
                            message: `√âch√©ance dans ${diffDays} jour(s)`,
                            priority: 'medium',
                            icon: 'üìÖ',
                            date: p.deadline
                        });
                    } else if (diffDays <= 7) {
                        notifs.push({
                            type: 'upcoming',
                            title: p.name,
                            message: `√âch√©ance dans ${diffDays} jours`,
                            priority: 'low',
                            icon: 'üìå',
                            date: p.deadline
                        });
                    }
                });

                // √âv√©nements du calendrier proches
                calendar.forEach(c => {
                    const eventDate = new Date(c.date);
                    eventDate.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));

                    if (diffDays >= 0 && diffDays <= 7) {
                        let priority = 'low';
                        if (c.critical) priority = 'high';
                        else if (diffDays <= 3) priority = 'medium';

                        notifs.push({
                            type: 'event',
                            title: c.label,
                            message: diffDays === 0 ? "Aujourd'hui" : `Dans ${diffDays} jour(s)`,
                            priority: priority,
                            icon: c.critical ? 'üèõÔ∏è' : 'üìÜ',
                            date: c.date,
                            project: c.project
                        });
                    }
                });

                // Trier par priorit√© puis par date
                const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
                return notifs.sort((a, b) => {
                    if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    }
                    return new Date(a.date) - new Date(b.date);
                });
            }, [projects, calendar]);

            const getPriorityColor = (priority) => {
                switch (priority) {
                    case 'critical': return 'bg-red-50 border-red-300';
                    case 'high': return 'bg-orange-50 border-orange-300';
                    case 'medium': return 'bg-yellow-50 border-yellow-300';
                    default: return 'bg-blue-50 border-blue-300';
                }
            };

            return (
                <>
                    {/* Overlay */}
                    {isOpen && (
                        <div
                            className="fixed inset-0 bg-black/20 z-50"
                            onClick={onClose}
                        />
                    )}

                    {/* Panel */}
                    <div className={`notification-panel ${isOpen ? 'open' : ''}`}>
                        <div className="gradient-header text-white px-6 py-4 flex justify-between items-center sticky top-0 z-10">
                            <h3 className="text-lg font-bold flex items-center gap-2">
                                <span>üîî</span> Notifications
                            </h3>
                            <button
                                onClick={onClose}
                                className="text-white hover:text-manche-gold text-2xl"
                            >
                                &times;
                            </button>
                        </div>

                        <div className="p-4">
                            {notifications.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    <span className="text-4xl block mb-3">‚úÖ</span>
                                    <p>Aucune √©ch√©ance proche</p>
                                    <p className="text-sm">Tout est sous contr√¥le !</p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    {notifications.map((notif, idx) => (
                                        <div
                                            key={idx}
                                            className={`p-4 rounded-lg border ${getPriorityColor(notif.priority)} ${notif.priority === 'critical' ? 'animate-pulse' : ''}`}
                                        >
                                            <div className="flex items-start gap-3">
                                                <span className="text-2xl">{notif.icon}</span>
                                                <div className="flex-1">
                                                    <p className="font-semibold text-gray-800">{notif.title}</p>
                                                    <p className="text-sm text-gray-600">{notif.message}</p>
                                                    {notif.project && (
                                                        <p className="text-xs text-gray-500 mt-1">
                                                            Projet: {notif.project}
                                                        </p>
                                                    )}
                                                    <p className="text-xs text-gray-400 mt-1">
                                                        {new Date(notif.date).toLocaleDateString('fr-FR', {
                                                            weekday: 'long',
                                                            day: 'numeric',
                                                            month: 'long'
                                                        })}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* L√©gende */}
                        <div className="p-4 border-t bg-gray-50">
                            <p className="text-xs font-semibold text-gray-500 mb-2">L√©gende</p>
                            <div className="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded bg-red-400"></span> Critique/En retard</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded bg-orange-400"></span> Aujourd'hui</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded bg-yellow-400"></span> Sous 3 jours</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded bg-blue-400"></span> Cette semaine</span>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // ========================================
        // PAGES
        // ========================================

        // Dashboard
        const Dashboard = ({ projects, calendar }) => {
            const today = new Date();
            const stats = useMemo(() => ({
                activeProjects: projects.filter(p => p.status === 'En cours').length,
                alertProjects: projects.filter(p => p.alert === 'red').length,
                upcomingDeadlines: calendar.filter(c => new Date(c.date) > today && new Date(c.date) < new Date(today.getTime() + 30*24*60*60*1000)).length,
                overdueActions: projects.filter(p => new Date(p.deadline) < today && p.status !== 'Termin√©').length
            }), [projects, calendar]);

            const nextDeadline = calendar.filter(c => new Date(c.date) >= today).sort((a,b) => new Date(a.date) - new Date(b.date))[0];
            const criticalProjects = projects.filter(p => p.alert === 'red' || p.priority === 'P0');

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">Tableau de bord</h2>
                        <p className="text-gray-500">Vue d'ensemble de votre portefeuille projets</p>
                    </div>

                    {/* KPIs */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <StatCard 
                            label="Projets actifs" 
                            value={stats.activeProjects} 
                            icon="üìÇ" 
                            color="border-manche-blue"
                            subtext={`sur ${projects.length} projets`}
                        />
                        <StatCard 
                            label="En alerte" 
                            value={stats.alertProjects} 
                            icon="‚ö†Ô∏è" 
                            color="border-red-500"
                            subtext="n√©cessitent attention"
                        />
                        <StatCard 
                            label="√âch√©ances 30j" 
                            value={stats.upcomingDeadlines} 
                            icon="üìÖ" 
                            color="border-manche-gold"
                        />
                        <StatCard 
                            label="Prochaine instance" 
                            value={nextDeadline ? new Date(nextDeadline.date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' }) : '-'} 
                            icon="üèõÔ∏è" 
                            color="border-green-500"
                            subtext={nextDeadline?.label}
                        />
                    </div>

                    {/* Projets critiques */}
                    <div className="bg-white rounded-xl card-shadow p-6 mb-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span className="text-red-500">üî¥</span> Projets prioritaires (P0 / En alerte)
                        </h3>
                        <div className="space-y-3">
                            {criticalProjects.map(project => (
                                <div key={project.id} className={`p-4 rounded-lg bg-gray-50 priority-${project.priority.toLowerCase()}`}>
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-1">
                                                <PriorityBadge priority={project.priority} />
                                                <span className="font-semibold text-gray-800">{project.name}</span>
                                            </div>
                                            <p className="text-sm text-gray-600">{project.nextAction}</p>
                                        </div>
                                        <div className="text-right">
                                            <AlertBadge level={project.alert} />
                                            <p className="text-sm text-gray-500 mt-1">
                                                {new Date(project.deadline).toLocaleDateString('fr-FR')}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="mt-3">
                                        <div className="flex justify-between text-xs text-gray-500 mb-1">
                                            <span>Avancement</span>
                                            <span>{project.progress}%</span>
                                        </div>
                                        <ProgressBar value={project.progress} />
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Prochaines √©ch√©ances */}
                    <div className="bg-white rounded-xl card-shadow p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span>üèõÔ∏è</span> Prochaines √©ch√©ances institutionnelles
                        </h3>
                        <div className="space-y-2">
                            {calendar.filter(c => new Date(c.date) >= today).slice(0, 5).map((event, idx) => (
                                <div 
                                    key={idx} 
                                    className={`flex items-center justify-between p-3 rounded-lg ${event.critical ? 'bg-red-50 border border-red-200' : 'bg-gray-50'}`}
                                >
                                    <div className="flex items-center gap-3">
                                        <span className={`text-sm font-bold ${event.critical ? 'text-red-600' : 'text-manche-blue'}`}>
                                            {new Date(event.date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' })}
                                        </span>
                                        <span className="text-gray-700">{event.label}</span>
                                    </div>
                                    {event.project && (
                                        <span className="text-sm text-gray-500 bg-white px-2 py-1 rounded">
                                            {event.project}
                                        </span>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // Modal d'√©dition de projet
        const ProjectModal = ({ project, onSave, onClose }) => {
            const [formData, setFormData] = useState(project || {
                id: Date.now(),
                name: '',
                program: 'Strat√©gie IA/Data',
                process: 'Conception',
                phase: '√Ä lancer',
                status: '√Ä planifier',
                progress: 0,
                alert: 'green',
                priority: 'P2',
                nextAction: '',
                deadline: new Date().toISOString().split('T')[0],
                responsible: '',
                notes: ''
            });

            const handleChange = (field, value) => {
                setFormData({ ...formData, [field]: value });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                        <div className="gradient-header text-white px-6 py-4 flex justify-between items-center sticky top-0">
                            <h3 className="text-xl font-bold">
                                {project ? '‚úèÔ∏è Modifier le projet' : '‚ûï Nouveau projet'}
                            </h3>
                            <button onClick={onClose} className="text-white hover:text-manche-gold text-2xl">&times;</button>
                        </div>

                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Nom du projet */}
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">
                                        Nom du projet <span className="text-red-500">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => handleChange('name', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                        required
                                    />
                                </div>

                                {/* Programme */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Programme</label>
                                    <select
                                        value={formData.program}
                                        onChange={(e) => handleChange('program', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option>Strat√©gie IA/Data</option>
                                        <option>Modernisation</option>
                                        <option>Autre</option>
                                    </select>
                                </div>

                                {/* Processus */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Processus</label>
                                    <select
                                        value={formData.process}
                                        onChange={(e) => handleChange('process', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option>Conception</option>
                                        <option>Mise en ≈ìuvre</option>
                                        <option>Exploitation</option>
                                    </select>
                                </div>

                                {/* Phase */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Phase</label>
                                    <select
                                        value={formData.phase}
                                        onChange={(e) => handleChange('phase', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option>√Ä lancer</option>
                                        <option>Initialisation</option>
                                        <option>En cours</option>
                                        <option>Finalisation</option>
                                        <option>Cl√¥tur√©</option>
                                    </select>
                                </div>

                                {/* Statut */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Statut</label>
                                    <select
                                        value={formData.status}
                                        onChange={(e) => handleChange('status', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option>√Ä planifier</option>
                                        <option>En cours</option>
                                        <option>En attente</option>
                                        <option>Termin√©</option>
                                    </select>
                                </div>

                                {/* Priorit√© */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Priorit√©</label>
                                    <select
                                        value={formData.priority}
                                        onChange={(e) => handleChange('priority', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option>P0</option>
                                        <option>P1</option>
                                        <option>P2</option>
                                        <option>P3</option>
                                    </select>
                                </div>

                                {/* Alerte */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Niveau d'alerte</label>
                                    <select
                                        value={formData.alert}
                                        onChange={(e) => handleChange('alert', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    >
                                        <option value="green">üü¢ Vert - OK</option>
                                        <option value="yellow">üü° Jaune - Vigilance</option>
                                        <option value="red">üî¥ Rouge - Alerte</option>
                                    </select>
                                </div>

                                {/* Progression */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">
                                        Progression ({formData.progress}%)
                                    </label>
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={formData.progress}
                                        onChange={(e) => handleChange('progress', parseInt(e.target.value))}
                                        className="w-full"
                                    />
                                </div>

                                {/* √âch√©ance */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">√âch√©ance</label>
                                    <input
                                        type="date"
                                        value={formData.deadline}
                                        onChange={(e) => handleChange('deadline', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                    />
                                </div>

                                {/* Responsable */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Responsable</label>
                                    <input
                                        type="text"
                                        value={formData.responsible}
                                        onChange={(e) => handleChange('responsible', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                        placeholder="Nom du responsable"
                                    />
                                </div>

                                {/* Prochaine action */}
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Prochaine action</label>
                                    <input
                                        type="text"
                                        value={formData.nextAction}
                                        onChange={(e) => handleChange('nextAction', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none"
                                        placeholder="Quelle est la prochaine √©tape ?"
                                    />
                                </div>

                                {/* Notes */}
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-semibold text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => handleChange('notes', e.target.value)}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-manche-blue focus:outline-none h-24"
                                        placeholder="Notes additionnelles..."
                                    />
                                </div>
                            </div>

                            {/* Boutons d'action */}
                            <div className="flex gap-3 pt-4 border-t">
                                <button
                                    type="submit"
                                    className="flex-1 bg-manche-blue text-white py-2 px-4 rounded-lg font-medium hover:bg-manche-dark transition-colors"
                                >
                                    üíæ Enregistrer
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-6 bg-gray-200 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                                >
                                    Annuler
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Liste des projets
        const ProjectsList = ({ projects, setProjects }) => {
            const [filter, setFilter] = useState('all');
            const [editingProject, setEditingProject] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);

            const filteredProjects = useMemo(() => {
                if (filter === 'all') return projects;
                if (filter === 'alert') return projects.filter(p => p.alert === 'red');
                if (filter === 'active') return projects.filter(p => p.status === 'En cours');
                return projects.filter(p => p.program === filter);
            }, [projects, filter]);

            const updateProject = (id, field, value) => {
                setProjects(projects.map(p => p.id === id ? { ...p, [field]: value } : p));
            };

            const handleSaveProject = (projectData) => {
                if (projectData.id && projects.find(p => p.id === projectData.id)) {
                    // Mise √† jour d'un projet existant
                    setProjects(projects.map(p => p.id === projectData.id ? projectData : p));
                } else {
                    // Ajout d'un nouveau projet
                    setProjects([...projects, { ...projectData, id: Date.now() }]);
                }
            };

            const handleDeleteProject = (id) => {
                if (confirm('√ätes-vous s√ªr de vouloir supprimer ce projet ?')) {
                    setProjects(projects.filter(p => p.id !== id));
                }
            };

            const openEditModal = (project) => {
                setEditingProject(project);
                setIsModalOpen(true);
            };

            const openNewModal = () => {
                setEditingProject(null);
                setIsModalOpen(true);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setEditingProject(null);
            };

            return (
                <div className="animate-fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800">Portefeuille Projets</h2>
                            <p className="text-gray-500">{projects.length} projets au total</p>
                        </div>
                        <div className="flex gap-2 items-center">
                            <button
                                onClick={openNewModal}
                                className="px-4 py-2 bg-manche-gold text-white rounded-lg font-medium hover:bg-yellow-600 transition-colors flex items-center gap-2"
                            >
                                <span>‚ûï</span> Nouveau projet
                            </button>
                            {['all', 'active', 'alert', 'Strat√©gie IA/Data', 'Modernisation'].map(f => (
                                <button
                                    key={f}
                                    onClick={() => setFilter(f)}
                                    className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${
                                        filter === f
                                            ? 'bg-manche-blue text-white'
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }`}
                                >
                                    {f === 'all' ? 'Tous' : f === 'active' ? 'Actifs' : f === 'alert' ? 'En alerte' : f}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="bg-white rounded-xl card-shadow overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50 border-b">
                                <tr>
                                    <th className="text-left p-4 font-semibold text-gray-600">Projet</th>
                                    <th className="text-left p-4 font-semibold text-gray-600">Phase</th>
                                    <th className="text-left p-4 font-semibold text-gray-600">Statut</th>
                                    <th className="text-center p-4 font-semibold text-gray-600">Prio</th>
                                    <th className="text-center p-4 font-semibold text-gray-600">Alerte</th>
                                    <th className="text-left p-4 font-semibold text-gray-600">Prochaine action</th>
                                    <th className="text-center p-4 font-semibold text-gray-600">√âch√©ance</th>
                                    <th className="text-center p-4 font-semibold text-gray-600">%</th>
                                    <th className="text-center p-4 font-semibold text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredProjects.map(project => (
                                    <tr
                                        key={project.id}
                                        className={`border-b hover:bg-gray-50 transition-colors priority-${project.priority.toLowerCase()}`}
                                    >
                                        <td className="p-4">
                                            <p className="font-medium text-gray-800">{project.name}</p>
                                            <p className="text-xs text-gray-500">{project.program}</p>
                                        </td>
                                        <td className="p-4">
                                            <span className="text-sm text-gray-600">{project.phase}</span>
                                        </td>
                                        <td className="p-4">
                                            <select
                                                value={project.status}
                                                onChange={(e) => updateProject(project.id, 'status', e.target.value)}
                                                className="text-sm border rounded px-2 py-1"
                                            >
                                                <option>√Ä planifier</option>
                                                <option>En cours</option>
                                                <option>En attente</option>
                                                <option>Termin√©</option>
                                            </select>
                                        </td>
                                        <td className="p-4 text-center">
                                            <PriorityBadge priority={project.priority} />
                                        </td>
                                        <td className="p-4 text-center">
                                            <select
                                                value={project.alert}
                                                onChange={(e) => updateProject(project.id, 'alert', e.target.value)}
                                                className="text-sm border rounded px-2 py-1"
                                            >
                                                <option value="green">üü¢</option>
                                                <option value="yellow">üü°</option>
                                                <option value="red">üî¥</option>
                                            </select>
                                        </td>
                                        <td className="p-4">
                                            <input
                                                type="text"
                                                value={project.nextAction}
                                                onChange={(e) => updateProject(project.id, 'nextAction', e.target.value)}
                                                className="text-sm w-full border-b border-transparent hover:border-gray-300 focus:border-manche-blue focus:outline-none py-1"
                                            />
                                        </td>
                                        <td className="p-4 text-center">
                                            <input
                                                type="date"
                                                value={project.deadline}
                                                onChange={(e) => updateProject(project.id, 'deadline', e.target.value)}
                                                className="text-sm border rounded px-2 py-1"
                                            />
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-2">
                                                <ProgressBar value={project.progress} />
                                                <span className="text-xs text-gray-500 w-8">{project.progress}%</span>
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex gap-2 justify-center">
                                                <button
                                                    onClick={() => openEditModal(project)}
                                                    className="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm"
                                                    title="Modifier"
                                                >
                                                    ‚úèÔ∏è
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteProject(project.id)}
                                                    className="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm"
                                                    title="Supprimer"
                                                >
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Modal d'√©dition */}
                    {isModalOpen && (
                        <ProjectModal
                            project={editingProject}
                            onSave={handleSaveProject}
                            onClose={closeModal}
                        />
                    )}
                </div>
            );
        };

        // R√©tro-planning Strat√©gie IA
        const RetroPlanning = () => {
            const milestones = [
                { date: "15-23/01/2026", label: "Sensibilisation √©lus", status: "√Ä confirmer", description: "Journ√©e sensibilisation + atelier co-construction", critical: false, highlight: true },
                { date: "30/01/2026", label: "Finalisation strat√©gie", status: "√Ä faire", description: "Int√©grer √©l√©ments co-construits dans document", critical: false, highlight: false },
                { date: "10/02/2026", label: "Relecture interne", status: "√Ä faire", description: "Relecture par chef de service + ajustements", critical: false, highlight: false },
                { date: "20/02/2026", label: "Pr√©-validation", status: "√Ä faire", description: "Validation informelle direction", critical: false, highlight: false },
                { date: "26/02/2026", label: "DLVD CD04", status: "Critique", description: "Validation directeurs - DEADLINE", critical: true, highlight: false },
                { date: "03/03/2026", label: "DLVR CD04", status: "Important", description: "Validation DGA", critical: false, highlight: false },
                { date: "10/03/2026", label: "Comit√© lecture", status: "√Ä faire", description: "Pr√©sentation aux √©lus", critical: false, highlight: false },
                { date: "03/04/2026", label: "SESSION PL√âNI√àRE", status: "Objectif", description: "Vote de la d√©lib√©ration", critical: true, highlight: true },
            ];

            const immediateActions = [
                { priority: "P0", action: "Proposer dates pour sensibilisation √©lus (15-23 janvier)", deadline: "10/01/2026", done: false },
                { priority: "P0", action: "Confirmer disponibilit√© prestataire sensibilisation", deadline: "10/01/2026", done: false },
                { priority: "P0", action: "Briefer facilitateurs DSIM sur atelier apr√®s-midi", deadline: "13/01/2026", done: false },
                { priority: "P1", action: "Lister les √©l√©ments de strat√©gie √† co-construire", deadline: "10/01/2026", done: false },
                { priority: "P1", action: "Pr√©parer trame document strat√©gie (parties r√©dig√©es)", deadline: "15/01/2026", done: false },
            ];

            const [actions, setActions] = useState(immediateActions);

            const toggleAction = (index) => {
                const newActions = [...actions];
                newActions[index].done = !newActions[index].done;
                setActions(newActions);
            };

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">R√©tro-planning Strat√©gie IA/Data</h2>
                        <p className="text-gray-500">Session pl√©ni√®re du 03/04/2026</p>
                    </div>

                    {/* Timeline visuelle */}
                    <div className="bg-white rounded-xl card-shadow p-6 mb-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">üìÖ Jalons cl√©s</h3>
                        <div className="relative pl-8">
                            <div className="absolute left-3 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                            {milestones.map((milestone, idx) => (
                                <div key={idx} className="relative mb-6 last:mb-0">
                                    <div className={`timeline-dot ${
                                        milestone.critical ? 'bg-red-500' : 
                                        milestone.highlight ? 'bg-manche-gold' : 'bg-manche-blue'
                                    }`}></div>
                                    <div className={`ml-4 p-4 rounded-lg ${
                                        milestone.critical ? 'bg-red-50 border border-red-200' :
                                        milestone.highlight ? 'bg-yellow-50 border border-yellow-200' : 'bg-gray-50'
                                    }`}>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <span className={`text-sm font-bold ${milestone.critical ? 'text-red-600' : 'text-manche-blue'}`}>
                                                    {milestone.date}
                                                </span>
                                                <h4 className="font-semibold text-gray-800">{milestone.label}</h4>
                                                <p className="text-sm text-gray-600">{milestone.description}</p>
                                            </div>
                                            <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                milestone.status === 'Critique' ? 'bg-red-100 text-red-700' :
                                                milestone.status === 'Objectif' ? 'bg-green-100 text-green-700' :
                                                milestone.status === '√Ä confirmer' ? 'bg-yellow-100 text-yellow-700' :
                                                'bg-gray-100 text-gray-600'
                                            }`}>
                                                {milestone.status}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* D√©pendances critiques */}
                    <div className="bg-red-50 border border-red-200 rounded-xl p-6 mb-6">
                        <h3 className="text-lg font-bold text-red-800 mb-4">‚ö†Ô∏è D√©pendances critiques</h3>
                        <ul className="space-y-2 text-red-700">
                            <li>1. La sensibilisation √©lus <strong>DOIT</strong> avoir lieu avant fin janvier</li>
                            <li>2. Le prestataire pour la matin√©e doit √™tre confirm√© rapidement</li>
                            <li>3. Les facilitateurs DSIM doivent construire le d√©roul√© de l'atelier</li>
                            <li>4. Les √©l√©ments co-construits doivent √™tre int√©grables dans la strat√©gie</li>
                        </ul>
                    </div>

                    {/* Actions imm√©diates */}
                    <div className="bg-white rounded-xl card-shadow p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">üöÄ Actions imm√©diates</h3>
                        <div className="space-y-2">
                            {actions.map((action, idx) => (
                                <div 
                                    key={idx}
                                    onClick={() => toggleAction(idx)}
                                    className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${
                                        action.done ? 'bg-green-50' : 'bg-gray-50 hover:bg-gray-100'
                                    }`}
                                >
                                    <input 
                                        type="checkbox" 
                                        checked={action.done}
                                        onChange={() => {}}
                                        className="w-5 h-5 rounded border-gray-300"
                                    />
                                    <PriorityBadge priority={action.priority} />
                                    <span className={`flex-1 ${action.done ? 'line-through text-gray-400' : 'text-gray-700'}`}>
                                        {action.action}
                                    </span>
                                    <span className="text-sm text-gray-500">{action.deadline}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // Calendrier
        const Calendar = ({ calendar }) => {
            const today = new Date();
            const months = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet'];
            
            const eventsByMonth = useMemo(() => {
                const grouped = {};
                calendar.forEach(event => {
                    const month = new Date(event.date).getMonth();
                    if (!grouped[month]) grouped[month] = [];
                    grouped[month].push(event);
                });
                return grouped;
            }, [calendar]);

            const getEventStyle = (event) => {
                if (event.critical) return 'bg-red-100 border-red-300 text-red-800';
                if (event.type === 'SP') return 'bg-green-100 border-green-300 text-green-800';
                if (event.type === 'CP') return 'bg-blue-100 border-blue-300 text-blue-800';
                if (event.type === 'cible') return 'bg-yellow-100 border-yellow-300 text-yellow-800';
                return 'bg-gray-100 border-gray-300 text-gray-800';
            };

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">Calendrier Institutionnel 2026</h2>
                        <p className="text-gray-500">Commissions permanentes, sessions pl√©ni√®res et jalons projets</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {months.map((month, monthIdx) => (
                            <div key={month} className="bg-white rounded-xl card-shadow p-4">
                                <h3 className="font-bold text-gray-800 mb-3 pb-2 border-b">{month} 2026</h3>
                                <div className="space-y-2">
                                    {(eventsByMonth[monthIdx] || []).map((event, idx) => (
                                        <div 
                                            key={idx}
                                            className={`p-2 rounded border text-sm ${getEventStyle(event)}`}
                                        >
                                            <div className="flex justify-between items-start">
                                                <span className="font-semibold">
                                                    {new Date(event.date).toLocaleDateString('fr-FR', { day: '2-digit' })}
                                                </span>
                                                <span className="text-xs px-1.5 py-0.5 rounded bg-white/50">
                                                    {event.type}
                                                </span>
                                            </div>
                                            <p className="mt-1">{event.label}</p>
                                            {event.project && (
                                                <p className="text-xs mt-1 opacity-75">{event.project}</p>
                                            )}
                                        </div>
                                    ))}
                                    {!eventsByMonth[monthIdx]?.length && (
                                        <p className="text-gray-400 text-sm italic">Aucun √©v√©nement</p>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* L√©gende */}
                    <div className="mt-6 bg-white rounded-xl card-shadow p-4">
                        <h4 className="font-semibold text-gray-700 mb-3">L√©gende</h4>
                        <div className="flex flex-wrap gap-4 text-sm">
                            <span className="flex items-center gap-2"><span className="w-3 h-3 rounded bg-blue-400"></span> CP = Commission Permanente</span>
                            <span className="flex items-center gap-2"><span className="w-3 h-3 rounded bg-green-400"></span> SP = Session Pl√©ni√®re</span>
                            <span className="flex items-center gap-2"><span className="w-3 h-3 rounded bg-yellow-400"></span> Jalon projet</span>
                            <span className="flex items-center gap-2"><span className="w-3 h-3 rounded bg-red-400"></span> Critique</span>
                        </div>
                    </div>
                </div>
            );
        };

        // Check-lists
        const Checklists = () => {
            const [activeChecklist, setActiveChecklist] = useState('conception');
            
            const conceptionChecklist = [
                { section: "STRUCTURER ET CADRER LE PROJET", tasks: [
                    { label: "Nommer le co-pilote DSIM", done: false },
                    { label: "Partager les objectifs, enjeux et attendus", done: false },
                    { label: "Cr√©er l'√©quipe projet", done: false },
                    { label: "Organiser les canaux de communication Teams", done: false },
                    { label: "Poursuivre et finaliser l'√©tude du besoin", done: false },
                    { label: "√âvaluer les risques et opportunit√©s", done: false },
                    { label: "Co-r√©diger et valider la lettre de mission", done: false },
                ]},
                { section: "COPIL DE LANCEMENT", tasks: [
                    { label: "Pr√©parer le support COPIL", done: false },
                    { label: "Tenir le COPIL de lancement", done: false },
                    { label: "R√©diger et diffuser le compte-rendu", done: false },
                    { label: "Changer la phase Seatable : Lancement", done: false },
                ]},
                { section: "G√âRER LA CONCEPTION", tasks: [
                    { label: "Approfondir la faisabilit√© technique et financi√®re", done: false },
                    { label: "√âlaborer le cahier des charges avec COTECH d√©di√©s", done: false },
                    { label: "Int√©grer les clauses de s√©curit√© (RSSI)", done: false },
                    { label: "Int√©grer l'accessibilit√©", done: false },
                    { label: "Int√©grer la gestion des donn√©es personnelles (DPO)", done: false },
                    { label: "Choisir la proc√©dure d'achat", done: false },
                ]},
                { section: "VALIDER LA CONCEPTION", tasks: [
                    { label: "Validation du sc√©nario en COPIL", done: false },
                    { label: "Validation du choix de la solution", done: false },
                    { label: "Validation du planning de d√©ploiement", done: false },
                ]},
            ];

            const mepChecklist = [
                { section: "CONSTRUIRE LE SERVICE", tasks: [
                    { label: "Pr√©parer les environnements techniques", done: false },
                    { label: "D√©velopper/configurer le service", done: false },
                    { label: "Initialiser le dossier d'exploitation", done: false },
                ]},
                { section: "MOM - MISE EN ORDRE DE MARCHE", tasks: [
                    { label: "V√©rifier composants techniques op√©rationnels", done: false },
                    { label: "Pr√©parer support COTECH/COPIL MOM", done: false },
                    { label: "R√©diger PV de MOM", done: false },
                ]},
                { section: "VA - V√âRIFICATION D'APTITUDE", tasks: [
                    { label: "Ex√©cuter les tests fonctionnels", done: false },
                    { label: "Former les utilisateurs pilotes", done: false },
                    { label: "R√©diger PV de VA", done: false },
                ]},
                { section: "VSR - V√âRIFICATION SERVICE R√âGULIER", tasks: [
                    { label: "V√©rifier stabilit√© du service en production", done: false },
                    { label: "R√©diger PV de VSR", done: false },
                    { label: "Archiver les documents projet", done: false },
                ]},
            ];

            const [conception, setConception] = useState(conceptionChecklist);
            const [mep, setMep] = useState(mepChecklist);

            const currentChecklist = activeChecklist === 'conception' ? conception : mep;
            const setCurrentChecklist = activeChecklist === 'conception' ? setConception : setMep;

            const toggleTask = (sectionIdx, taskIdx) => {
                const newChecklist = [...currentChecklist];
                newChecklist[sectionIdx].tasks[taskIdx].done = !newChecklist[sectionIdx].tasks[taskIdx].done;
                setCurrentChecklist(newChecklist);
            };

            const totalTasks = currentChecklist.reduce((acc, s) => acc + s.tasks.length, 0);
            const doneTasks = currentChecklist.reduce((acc, s) => acc + s.tasks.filter(t => t.done).length, 0);

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">Check-lists M√©thodologie DSIM</h2>
                        <p className="text-gray-500">Suivez les √©tapes de vos processus</p>
                    </div>

                    {/* Tabs */}
                    <div className="flex gap-2 mb-6">
                        <button
                            onClick={() => setActiveChecklist('conception')}
                            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                activeChecklist === 'conception' 
                                    ? 'bg-manche-blue text-white' 
                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                            }`}
                        >
                            Conception
                        </button>
                        <button
                            onClick={() => setActiveChecklist('mep')}
                            className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                activeChecklist === 'mep' 
                                    ? 'bg-manche-blue text-white' 
                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                            }`}
                        >
                            Mise en ≈ìuvre
                        </button>
                    </div>

                    {/* Progress */}
                    <div className="bg-white rounded-xl card-shadow p-4 mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <span className="font-medium text-gray-700">Progression globale</span>
                            <span className="text-manche-blue font-bold">{doneTasks}/{totalTasks} t√¢ches</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-3">
                            <div 
                                className="bg-manche-gold h-3 rounded-full transition-all duration-500"
                                style={{ width: `${(doneTasks/totalTasks)*100}%` }}
                            />
                        </div>
                    </div>

                    {/* Checklist */}
                    <div className="space-y-4">
                        {currentChecklist.map((section, sectionIdx) => (
                            <div key={sectionIdx} className="bg-white rounded-xl card-shadow overflow-hidden">
                                <div className="bg-manche-blue text-white px-4 py-3 font-semibold">
                                    {section.section}
                                </div>
                                <div className="p-4 space-y-2">
                                    {section.tasks.map((task, taskIdx) => (
                                        <div 
                                            key={taskIdx}
                                            onClick={() => toggleTask(sectionIdx, taskIdx)}
                                            className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${
                                                task.done ? 'bg-green-50' : 'bg-gray-50 hover:bg-gray-100'
                                            }`}
                                        >
                                            <input 
                                                type="checkbox" 
                                                checked={task.done}
                                                onChange={() => {}}
                                                className="w-5 h-5 rounded border-gray-300"
                                            />
                                            <span className={task.done ? 'line-through text-gray-400' : 'text-gray-700'}>
                                                {task.label}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Revue hebdomadaire
        const WeeklyReview = () => {
            const [reviews, setReviews] = useState([]);
            const [currentReview, setCurrentReview] = useState({
                weekOf: new Date().toISOString().split('T')[0],
                priorities: '',
                deadlines: '',
                risks: '',
                achievements: '',
                lessons: '',
                nextWeek: '',
            });

            const saveReview = () => {
                setReviews([...reviews, { ...currentReview, id: Date.now() }]);
                setCurrentReview({
                    weekOf: new Date().toISOString().split('T')[0],
                    priorities: '',
                    deadlines: '',
                    risks: '',
                    achievements: '',
                    lessons: '',
                    nextWeek: '',
                });
            };

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">Revue Hebdomadaire</h2>
                        <p className="text-gray-500">Rituels lundi matin et vendredi apr√®s-midi</p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Revue Lundi */}
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <span>üìÖ</span> Revue Lundi - Planification
                            </h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Semaine du
                                    </label>
                                    <input
                                        type="date"
                                        value={currentReview.weekOf}
                                        onChange={(e) => setCurrentReview({...currentReview, weekOf: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        üéØ Top 3 priorit√©s de la semaine
                                    </label>
                                    <textarea
                                        value={currentReview.priorities}
                                        onChange={(e) => setCurrentReview({...currentReview, priorities: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-24"
                                        placeholder="1. ...&#10;2. ...&#10;3. ..."
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        üìÖ √âch√©ances de la semaine
                                    </label>
                                    <textarea
                                        value={currentReview.deadlines}
                                        onChange={(e) => setCurrentReview({...currentReview, deadlines: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-20"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        ‚ö†Ô∏è Risques / Points de vigilance
                                    </label>
                                    <textarea
                                        value={currentReview.risks}
                                        onChange={(e) => setCurrentReview({...currentReview, risks: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-20"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Revue Vendredi */}
                        <div className="bg-white rounded-xl card-shadow p-6">
                            <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <span>‚úÖ</span> Revue Vendredi - Bilan
                            </h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        üèÜ R√©alisations de la semaine
                                    </label>
                                    <textarea
                                        value={currentReview.achievements}
                                        onChange={(e) => setCurrentReview({...currentReview, achievements: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-24"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        üí° Le√ßons apprises
                                    </label>
                                    <textarea
                                        value={currentReview.lessons}
                                        onChange={(e) => setCurrentReview({...currentReview, lessons: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-20"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        ‚û°Ô∏è √Ä pr√©parer pour la semaine prochaine
                                    </label>
                                    <textarea
                                        value={currentReview.nextWeek}
                                        onChange={(e) => setCurrentReview({...currentReview, nextWeek: e.target.value})}
                                        className="w-full border rounded-lg px-3 py-2 h-20"
                                    />
                                </div>
                                <button
                                    onClick={saveReview}
                                    className="w-full bg-manche-blue text-white py-2 rounded-lg font-medium hover:bg-manche-dark transition-colors"
                                >
                                    Sauvegarder la revue
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Questions rituelles */}
                    <div className="mt-6 bg-manche-light rounded-xl p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">üí° Questions rituelles</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 className="font-semibold text-manche-blue mb-2">LUNDI</h4>
                                <ul className="text-sm text-gray-600 space-y-1">
                                    <li>1. Quelles sont mes 3 priorit√©s absolues ?</li>
                                    <li>2. Quelles √©ch√©ances institutionnelles arrivent ?</li>
                                    <li>3. Quels projets n√©cessitent une attention particuli√®re ?</li>
                                    <li>4. De quoi ai-je besoin pour avancer ?</li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-semibold text-manche-blue mb-2">VENDREDI</h4>
                                <ul className="text-sm text-gray-600 space-y-1">
                                    <li>1. Qu'ai-je accompli dont je suis fier(e) ?</li>
                                    <li>2. Qu'est-ce qui n'a pas avanc√© et pourquoi ?</li>
                                    <li>3. Qu'ai-je appris cette semaine ?</li>
                                    <li>4. Que dois-je pr√©parer pour la semaine prochaine ?</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Objectifs 2026
        const Objectives = () => {
            const [objectives, setObjectives] = useState([
                { id: 1, objective: "Objectif strat√©gique 1", keyResults: [
                    { kr: "√Ä d√©finir apr√®s entretien annuel", target: "", current: "", deadline: "30/06/2026" },
                ]},
            ]);

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-gray-800">Objectifs 2026</h2>
                        <p className="text-gray-500">M√©thode OKR - √Ä compl√©ter apr√®s l'entretien annuel</p>
                    </div>

                    <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-6">
                        <h3 className="font-bold text-yellow-800 mb-2">üìÖ Entretien annuel dans ~15 jours</h3>
                        <p className="text-yellow-700">
                            Cette section sera √† compl√©ter apr√®s ton entretien annuel avec tes objectifs valid√©s.
                            La m√©thode OKR te permettra de suivre ta progression tout au long de l'ann√©e.
                        </p>
                    </div>

                    <div className="bg-white rounded-xl card-shadow p-6 mb-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">üí° Rappel m√©thode OKR</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div className="bg-gray-50 p-4 rounded-lg">
                                <h4 className="font-semibold text-manche-blue mb-2">Objectif (O)</h4>
                                <p className="text-gray-600">Qualitatif, inspirant, ambitieux. R√©pond √† "O√π veux-je aller ?"</p>
                            </div>
                            <div className="bg-gray-50 p-4 rounded-lg">
                                <h4 className="font-semibold text-manche-blue mb-2">R√©sultat Cl√© (KR)</h4>
                                <p className="text-gray-600">Quantitatif, mesurable, sp√©cifique. R√©pond √† "Comment savoir si j'y suis ?"</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-xl card-shadow p-6">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">üéØ Mes objectifs 2026</h3>
                        <p className="text-gray-500 italic">√Ä compl√©ter apr√®s l'entretien annuel...</p>
                    </div>
                </div>
            );
        };

        // ========================================
        // APP PRINCIPALE
        // ========================================
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [projects, setProjects] = useState(() => {
                const saved = localStorage.getItem('cockpit-projects');
                return saved ? JSON.parse(saved) : initialProjects;
            });
            const [calendar, setCalendar] = useState(() => {
                const saved = localStorage.getItem('cockpit-calendar');
                return saved ? JSON.parse(saved) : initialCalendar;
            });

            // √âtats pour la recherche et les notifications
            const [isSearchOpen, setIsSearchOpen] = useState(false);
            const [isNotifOpen, setIsNotifOpen] = useState(false);

            // Compteur de notifications
            const notificationCount = useMemo(() => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let count = 0;

                projects.forEach(p => {
                    if (p.status === 'Termin√©') return;
                    const deadline = new Date(p.deadline);
                    deadline.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                    if (diffDays <= 7) count++;
                });

                calendar.forEach(c => {
                    const eventDate = new Date(c.date);
                    eventDate.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                    if (diffDays >= 0 && diffDays <= 7) count++;
                });

                return count;
            }, [projects, calendar]);

            // Sauvegarde automatique
            useEffect(() => {
                localStorage.setItem('cockpit-projects', JSON.stringify(projects));
            }, [projects]);

            useEffect(() => {
                localStorage.setItem('cockpit-calendar', JSON.stringify(calendar));
            }, [calendar]);

            // Raccourci clavier Ctrl+K pour la recherche
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        setIsSearchOpen(prev => !prev);
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            // Fonction d'export JSON
            const handleExport = () => {
                const data = {
                    exportDate: new Date().toISOString(),
                    version: '1.0',
                    projects: projects,
                    calendar: calendar
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cockpit-projets-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('Export r√©ussi ! Le fichier a √©t√© t√©l√©charg√©.');
            };

            // Fonction d'import JSON
            const handleImport = (data) => {
                if (!data.projects || !Array.isArray(data.projects)) {
                    alert('Erreur: Format de fichier invalide. Le fichier doit contenir un tableau "projects".');
                    return;
                }

                const confirmImport = confirm(
                    `Voulez-vous importer ces donn√©es ?\n\n` +
                    `- ${data.projects.length} projet(s)\n` +
                    `- ${data.calendar?.length || 0} √©v√©nement(s)\n\n` +
                    `‚ö†Ô∏è Cela remplacera toutes les donn√©es actuelles.`
                );

                if (confirmImport) {
                    setProjects(data.projects);
                    if (data.calendar && Array.isArray(data.calendar)) {
                        setCalendar(data.calendar);
                    }
                    alert('Import r√©ussi ! Les donn√©es ont √©t√© charg√©es.');
                }
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard': return <Dashboard projects={projects} calendar={calendar} />;
                    case 'projects': return <ProjectsList projects={projects} setProjects={setProjects} />;
                    case 'retroplanning': return <RetroPlanning />;
                    case 'calendar': return <Calendar calendar={calendar} />;
                    case 'checklist': return <Checklists />;
                    case 'weekly': return <WeeklyReview />;
                    case 'objectives': return <Objectives />;
                    default: return <Dashboard projects={projects} calendar={calendar} />;
                }
            };

            return (
                <div className="flex">
                    <Sidebar
                        activeTab={activeTab}
                        setActiveTab={setActiveTab}
                        onExport={handleExport}
                        onImport={handleImport}
                    />

                    <main className="ml-64 flex-1 p-8 min-h-screen">
                        {/* Barre d'outils en haut */}
                        <div className="fixed top-0 right-0 left-64 bg-white/80 backdrop-blur-sm z-40 px-8 py-3 border-b flex justify-end gap-3">
                            {/* Bouton recherche */}
                            <button
                                onClick={() => setIsSearchOpen(true)}
                                className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors text-gray-600"
                            >
                                <span>üîç</span>
                                <span className="text-sm">Rechercher</span>
                                <kbd className="ml-2 px-2 py-0.5 bg-gray-200 rounded text-xs">Ctrl+K</kbd>
                            </button>

                            {/* Bouton notifications */}
                            <button
                                onClick={() => setIsNotifOpen(true)}
                                className="relative flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors text-gray-600"
                            >
                                <span>üîî</span>
                                <span className="text-sm">Notifications</span>
                                {notificationCount > 0 && (
                                    <span className="notification-badge">{notificationCount}</span>
                                )}
                            </button>
                        </div>

                        {/* Contenu avec marge pour la barre d'outils */}
                        <div className="mt-16">
                            {renderContent()}
                        </div>
                    </main>

                    {/* Recherche globale */}
                    <GlobalSearch
                        isOpen={isSearchOpen}
                        onClose={() => setIsSearchOpen(false)}
                        projects={projects}
                        calendar={calendar}
                        onNavigate={setActiveTab}
                    />

                    {/* Panneau de notifications */}
                    <NotificationPanel
                        isOpen={isNotifOpen}
                        onClose={() => setIsNotifOpen(false)}
                        projects={projects}
                        calendar={calendar}
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
